<!DOCTYPE html>
<html lang="en" theme="prefers">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Document</title>
    <link rel="stylesheet" href="/style.css">


</head>
<body class="bg-main text-main">
    <h1>Sass Palette Generator</h1>
    <p>
        Lorem ipsum dolor sit amet consectetur adipisicing elit. 
        Aliquid nam repellendus, 
        dicta quasi, odit adipisci laborum, 
        nostrum reiciendis officiis ipsam aut inventore. 
        Quaerat esse fuga cupiditate est commodi laborum quas.
    </p>
    <button id="palette-theme-switch">
        Theme Switch
    </button>
    <script>

        window.addEventListener('load', function(){

            let themeElement = document.querySelector('html')
            let themeSwitch = document.querySelector('#palette-theme-switch');
            let themes = window.getComputedStyle(themeElement).getPropertyValue('--toggle-themes').trim().split(/\s*,\s*/)

            function initTheme() {
                let store = localStorage.getItem('theme')
                if (store) {
                    setTheme(store)
                } 
            }

            function setTheme(name) {
                localStorage.setItem('theme', name)
                themeSwitch.setAttribute('theme' , name)
                themeElement.setAttribute('theme', name)
            }

            function toggleTheme() {
                let current = window.getComputedStyle(themeElement).getPropertyValue('--current-theme').trim()

                let index = themes.indexOf(current)
                
                if (index >= themes.length - 1) {
                    index = 0
                } else {
                    index += 1
                }
                setTheme(themes[index])
            };

            function resetTheme() {
                setTheme('default')
                localStorage.removeItem('theme')
            }

            initTheme()

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => resetTheme(), false);

            themeSwitch.addEventListener('click', e => toggleTheme(), false)

        }, false);
    </script>
</body>
</html>